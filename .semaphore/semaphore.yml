version: v1.0
name: 3decision Quickstart templates upload
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
global_job_config:
  # Connect secret to all jobs in the pipeline
  secrets:
    - name: 3dec-quickstart
blocks:
  - name: 3decision test templates upload
    run:
      when: "branch = 'main'"
    task:
      jobs:
        - name: 3decision templates upload
          commands:
            - checkout
            - export AWS_ACCESS_KEY_ID=${ACCESS_KEY}
            - export AWS_SECRET_ACCESS_KEY=${SECRET_ACCESS_KEY}
            - sh ~/quickstart-discngine-3decision/.semaphore/bin/rewrite_qss.sh quickstart-discngine-3decision-test/
            - aws s3 sync ~/quickstart-discngine-3decision/templates s3://3decision-eu-central-1/quickstart-discngine-3decision-test/templates
  - name: 3decision templates upload
    skip:
      when: "branch = 'main'"
    task:
      jobs:
        - name: 3decision templates upload
          commands:
            - checkout
            - export AWS_ACCESS_KEY_ID=${ACCESS_KEY}
            - export AWS_SECRET_ACCESS_KEY=${SECRET_ACCESS_KEY}
            - sh ~/quickstart-discngine-3decision/.semaphore/bin/rewrite_qss.sh quickstart-discngine-3decision/
            - aws s3 sync ~/quickstart-discngine-3decision/templates s3://3decision-eu-central-1/quickstart-discngine-3decision/templates
